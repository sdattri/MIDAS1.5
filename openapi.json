{"openapi":"3.1.0","info":{"title":"MIDAS API","description":"Market Informed Demand Automation Server API","contact":{"name":"California Energy Commission","email":"midas@energy.ca.gov"},"version":"1.5.0"},"paths":{"/api/Registration":{"post":{"tags":["authentication"],"summary":"Register User","operationId":"register_user_api_Registration_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegistrationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/Token":{"get":{"tags":["authentication"],"summary":"Get Authentication Token","operationId":"get_authentication_token_api_Token_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBasic":[]}]}},"/api/ResendVerification":{"post":{"tags":["authentication"],"summary":"Resend Verification Email","operationId":"resend_verification_email_api_ResendVerification_post","parameters":[{"name":"username","in":"query","required":true,"schema":{"type":"string","title":"Username"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Resend Verification Email Api Resendverification Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/ConfirmEmail":{"post":{"tags":["authentication"],"summary":"Confirm User Email Post","operationId":"confirm_user_email_post_api_ConfirmEmail_post","parameters":[{"name":"username","in":"query","required":true,"schema":{"type":"string","title":"Username"}},{"name":"confirmation_code","in":"query","required":true,"schema":{"type":"string","title":"Confirmation Code"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Confirm User Email Post Api Confirmemail Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/ForgotPassword":{"post":{"tags":["authentication"],"summary":"Initiate Password Reset","operationId":"initiate_password_reset_api_ForgotPassword_post","parameters":[{"name":"username","in":"query","required":true,"schema":{"type":"string","title":"Username"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Response Initiate Password Reset Api Forgotpassword Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/ConfirmPasswordReset":{"post":{"tags":["authentication"],"summary":"Confirm password reset","description":"Confirm a password reset using a one-time reset token.\n\n- Token is single-use and time-limited\n- New password is validated by AWS Cognito\n- Response is intentionally generic to prevent account enumeration","operationId":"confirm_password_reset_api_ConfirmPasswordReset_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConfirmPasswordResetRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ConfirmPasswordResetResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/UploadAccess/Request":{"post":{"tags":["authentication"],"summary":"Request Upload Access","description":"Allow a verified user to request upload access.","operationId":"request_upload_access_api_UploadAccess_Request_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UploadAccessRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Request Upload Access Api Uploadaccess Request Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/Admin/ApproveLSEAccess":{"post":{"tags":["admin"],"summary":"Approve Lse Access","description":"Approve LSE upload access for a user.\n\nSets:\n    - AccountType = \"lse\"\n    - EnergyCode\n    - DistributionCode\n\nAlso:\n    - Updates audit fields (ModifiedBy, ModifiedAt)\n    - Sends approval notification email to the user","operationId":"approve_lse_access_Admin_ApproveLSEAccess_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApproveAccess"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ApproveAccessResult"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/Admin/RemoveLSEAccess":{"post":{"tags":["admin"],"summary":"Remove Lse Access","description":"Remove LSE upload access from a user.\n\nResets:\n    - AccountType = \"user\"\n\nRemoves:\n    - EnergyCode attribute\n    - DistributionCode attribute\n\nAlso:\n    - Updates audit fields (ModifiedBy, ModifiedAt)\n    - Sends removal notification email to the user","operationId":"remove_lse_access_Admin_RemoveLSEAccess_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RemoveAccess"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RemoveAccessResult"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/Holiday":{"get":{"tags":["holiday"],"summary":"Get Holidays","description":"Get all holiday information.\n\nReturns holiday data including EnergyCode, EnergyDescription, DateOfHoliday, and HolidayDescription.\n\nArgs:\n    current_user: Current authenticated user\n\nReturns:\n    HolidayListResponse with list of holidays\n\nRaises:\n    HTTPException: If authentication fails or other errors occur","operationId":"get_holidays_api_Holiday_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]},"post":{"tags":["holiday"],"summary":"Create Holidays","description":"Upload holiday information for LSE accounts.\n\nAccepts holiday uploads (XML to converted to JSON by middleware),\nvalidates it, and passes it to the usecase for processing.\n\nArgs:\n    payload: JSON payload from HTTP body (converted from XML by middleware if needed)\n    current_user: Current authenticated and authorized LSE user\n\nReturns:\n    HTTP 200 on success, HTTP 417 on duplicates, HTTP 400/403 on validation errors\n\nRaises:\n    HTTPException: For various validation and authorization errors","operationId":"create_holidays_api_Holiday_post","requestBody":{"content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Payload"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/api/ValueData":{"get":{"tags":["value_data"],"summary":"Get Value Data","description":"Retrieve rate data, lookup tables, or XML schema based on query parameters.\n\nThis endpoint handles multiple operations based on query parameters:\n- No parameters: Return XML schema (LSE accounts only - requires authentication)\n- SignalType parameter: Return list of RINs by signal type (public access)\n- ID and QueryType parameters: Return rate values for specific RIN (public access)\n- LookupTable parameter: Return lookup table data (requires authentication)\n\nArgs:\n    request: FastAPI request object\n    current_user: Current authenticated user (optional for public endpoints)\n    signal_type: Signal type filter (0=all, 1=rates, 2=GHG, 3=FlexAlert)\n    rate_id: Rate ID for specific rate data\n    query_type: Query type (realtime, alldata)\n    lookup_table: Lookup table name\n\nReturns:\n    JSON response with requested data\n\nRaises:\n    HTTPException: 400 for invalid parameters, 401 for authentication required,\n                  403 for authorization errors, 404 for not found, 500 for server errors","operationId":"get_value_data_api_ValueData_get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"SignalType","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"description":"Signal type filter (0=all, 1=rates, 2=GHG, 3=FlexAlert)","title":"Signaltype"},"description":"Signal type filter (0=all, 1=rates, 2=GHG, 3=FlexAlert)"},{"name":"ID","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Rate ID for specific rate data","title":"Id"},"description":"Rate ID for specific rate data"},{"name":"QueryType","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Query type (realtime, alldata)","title":"Querytype"},"description":"Query type (realtime, alldata)"},{"name":"LookupTable","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Lookup table name","title":"Lookuptable"},"description":"Lookup table name"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["value_data"],"summary":"Upload Value Data","description":"Upload rate information and values for LSE accounts.\n\nAccepts rate data uploads (XML is converted to JSON by middleware),\nvalidates against user authorization, and passes it to the usecase for processing.\n\nArgs:\n    payload: JSON payload from HTTP body (converted from XML by middleware if needed)\n    current_user: Current authenticated and authorized LSE user\n\nReturns:\n    Upload response with processing information\n\nRaises:\n    HTTPException: 400 for validation errors, 500 for server errors","operationId":"upload_value_data_api_ValueData_post","security":[{"HTTPBearer":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","additionalProperties":true,"title":"Payload"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/watttime/health":{"get":{"tags":["WattTime Health"],"summary":"Get Health Status","description":"Get comprehensive health status of the WattTime token management system.\n\nReturns detailed information about:\n- Overall system health\n- Token expiration status\n- Circuit breaker state\n- Performance metrics\n- Cache performance\n\nReturns:\n    TokenServiceHealth: Comprehensive health status information","operationId":"get_health_status_watttime_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TokenServiceHealth"}}}}}}},"/watttime/health/detailed":{"get":{"tags":["WattTime Health"],"summary":"Get Detailed Health Status","description":"Get detailed health status including comprehensive metrics and circuit breaker state.\n\nThis endpoint provides more detailed information than the basic health check,\nincluding circuit breaker state, metrics, and correlation tracking.\n\nReturns:\n    Dict containing detailed health information","operationId":"get_detailed_health_status_watttime_health_detailed_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get Detailed Health Status Watttime Health Detailed Get"}}}}}}},"/watttime/health/refresh":{"post":{"tags":["WattTime Health"],"summary":"Trigger Token Refresh","description":"Manually trigger a token refresh operation.\n\nThis endpoint allows manual triggering of token refresh for testing\nand operational purposes. It returns the refresh result with correlation\ntracking for monitoring.\n\nReturns:\n    Dict containing refresh operation result","operationId":"trigger_token_refresh_watttime_health_refresh_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Trigger Token Refresh Watttime Health Refresh Post"}}}}}}},"/watttime/metrics":{"get":{"tags":["WattTime Health"],"summary":"Get Token Metrics","description":"Get current token management metrics.\n\nReturns operational metrics including success rates, latency,\ncache performance, and circuit breaker activations.\n\nReturns:\n    Dict containing current metrics","operationId":"get_token_metrics_watttime_metrics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get Token Metrics Watttime Metrics Get"}}}}}}},"/watttime/health/comprehensive":{"get":{"tags":["WattTime Health"],"summary":"Get Comprehensive Health Status","description":"Get comprehensive health status with calculated metrics for success rates and latency.\n\nThis endpoint provides detailed health information including:\n- Token service health status\n- Circuit breaker status reporting\n- Calculated success rates and latency metrics\n- Cache performance metrics\n- Real-time health assessment\n\nReturns:\n    Dict containing comprehensive health status with calculated metrics","operationId":"get_comprehensive_health_status_watttime_health_comprehensive_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get Comprehensive Health Status Watttime Health Comprehensive Get"}}}}}}},"/watttime/status":{"get":{"tags":["WattTime Health"],"summary":"Get Simple Status","description":"Get simple status check for basic monitoring.\n\nThis is a lightweight endpoint for basic health checks and monitoring\nsystems that need a simple up/down status.\n\nReturns:\n    Dict with simple status information","operationId":"get_simple_status_watttime_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Get Simple Status Watttime Status Get"}}}}}}},"/health":{"get":{"summary":"Health Check","description":"Health check endpoint for monitoring and load balancer health checks.","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/":{"get":{"summary":"Root","description":"Root endpoint providing basic API information.","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ApproveAccess":{"properties":{"username":{"type":"string","title":"Username","description":"Username of the user gaining LSE upload access"},"energy_code":{"type":"string","title":"Energy Code","description":"Two-letter energy code (validated by lookup table)"},"distribution_code":{"type":"string","title":"Distribution Code","description":"Two-letter distribution code (validated by lookup table)"}},"type":"object","required":["username","energy_code","distribution_code"],"title":"ApproveAccess","description":"Request model for approving a user's LSE upload access."},"ApproveAccessResult":{"properties":{"message":{"type":"string","title":"Message"},"username":{"type":"string","title":"Username"}},"type":"object","required":["message","username"],"title":"ApproveAccessResult","description":"Response model returned after successful LSE access approval."},"CircuitBreakerStatus":{"type":"string","enum":["closed","open","half-open"],"title":"CircuitBreakerStatus","description":"Circuit breaker status enumeration."},"ConfirmPasswordResetRequest":{"properties":{"token":{"type":"string","minLength":10,"title":"Token","description":"One-time password reset token received via email","examples":["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."]},"new_password":{"type":"string","minLength":8,"title":"New Password","description":"New account password (validated and enforced by Cognito policy)","examples":["Str0ngP@ssw0rd!"]}},"type":"object","required":["token","new_password"],"title":"ConfirmPasswordResetRequest"},"ConfirmPasswordResetResponse":{"properties":{"message":{"type":"string","title":"Message","description":"Generic result message to prevent information leakage","examples":["If the reset request is valid, the password has been updated."]}},"type":"object","required":["message"],"title":"ConfirmPasswordResetResponse"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"RegistrationResponse":{"properties":{"message":{"type":"string","title":"Message"},"username":{"type":"string","title":"Username"},"email_verification_sent":{"type":"boolean","title":"Email Verification Sent"}},"type":"object","required":["message","username","email_verification_sent"],"title":"RegistrationResponse","description":"Response model for user registration."},"RemoveAccess":{"properties":{"username":{"type":"string","title":"Username","description":"Username of the user whose access is being removed"}},"type":"object","required":["username"],"title":"RemoveAccess","description":"Request model for removing upload access from a user."},"RemoveAccessResult":{"properties":{"message":{"type":"string","title":"Message"},"username":{"type":"string","title":"Username"}},"type":"object","required":["message","username"],"title":"RemoveAccessResult","description":"Response model returned after successful LSE access removal."},"TokenServiceHealth":{"properties":{"healthy":{"type":"boolean","title":"Healthy","description":"Overall health status"},"last_refresh":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Refresh","description":"Last successful token refresh"},"token_expires_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Token Expires At","description":"Current token expiration time"},"time_until_expiry_minutes":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Time Until Expiry Minutes","description":"Minutes until token expires"},"consecutive_failures":{"type":"integer","title":"Consecutive Failures","description":"Number of consecutive refresh failures","default":0},"refresh_success_rate_24h":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Refresh Success Rate 24H","description":"24-hour refresh success rate","default":0.0},"average_refresh_latency_ms":{"type":"integer","minimum":0.0,"title":"Average Refresh Latency Ms","description":"Average refresh latency in milliseconds","default":0},"circuit_breaker_status":{"$ref":"#/components/schemas/CircuitBreakerStatus","description":"Circuit breaker status","default":"closed"},"cache_hit_rate":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Cache Hit Rate","description":"Token cache hit rate","default":0.0}},"type":"object","required":["healthy"],"title":"TokenServiceHealth","description":"Pydantic model for token service health status.","example":{"average_refresh_latency_ms":1250,"cache_hit_rate":0.85,"circuit_breaker_status":"closed","consecutive_failures":0,"healthy":true,"last_refresh":"2024-01-15T10:30:00Z","refresh_success_rate_24h":0.98,"time_until_expiry_minutes":25,"token_expires_at":"2024-01-15T11:00:00Z"}},"UploadAccessRequest":{"properties":{"energy_code":{"type":"string","title":"Energy Code","description":"Energy code requested for upload access"},"distribution_code":{"type":"string","title":"Distribution Code","description":"Distribution code requested for upload access"}},"type":"object","required":["energy_code","distribution_code"],"title":"UploadAccessRequest"},"UserCreate":{"properties":{"fullname":{"type":"string","title":"Fullname","description":"Base64 encoded full name"},"username":{"type":"string","title":"Username","description":"Base64 encoded username"},"password":{"type":"string","title":"Password","description":"Base64 encoded password"},"emailaddress":{"type":"string","title":"Emailaddress","description":"Base64 encoded email address"},"organization":{"type":"string","title":"Organization","description":"Base64 encoded organization name"}},"type":"object","required":["fullname","username","password","emailaddress","organization"],"title":"UserCreate","description":"Model for user registration data (base64 encoded fields)."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"HTTPBasic":{"type":"http","scheme":"basic"},"HTTPBearer":{"type":"http","scheme":"bearer"}}}}